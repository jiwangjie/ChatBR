{"bug_id": "45608", "title": "Bug 45608Race conditions on field countAllocated of class org.apache.catalina.core.StandardWrapper", "description": "We found field countAllocated are accessed by allocate() and deallocate() without any protections by locks.Here is a trace log,Thread http80811 id: 23 : READ[org.apache.catalina.core.StandardWrapper : allocate : 820][org.apache.catalina.core.StandardWrapperValve : invoke : 129][org.apache.catalina.core.StandardContextValve : invoke : 175][org.apache.catalina.core.StandardHostValve : invoke : 128][org.apache.catalina.valves.ErrorReportValve : invoke : 104][org.apache.catalina.core.StandardEngineValve : invoke : 109][org.apache.catalina.connector.CoyoteAdapter : service : 261][org.apache.coyote.http11.Http11Processor : process : 844][org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler : process : 581][org.apache.tomcat.util.net.JIoEndpoint$Worker : run : 447][java.lang.Thread : run : 735]Thread http80814 id: 26 : WRITE[org.apache.catalina.core.StandardWrapper : deallocate : 871][org.apache.catalina.core.StandardWrapperValve : invoke : 298][org.apache.catalina.core.StandardContextValve : invoke : 175][org.apache.catalina.core.StandardHostValve : invoke : 128][org.apache.catalina.valves.ErrorReportValve : invoke : 104][org.apache.catalina.core.StandardEngineValve : invoke : 109][org.apache.catalina.connector.CoyoteAdapter : service : 261][org.apache.coyote.http11.Http11Processor : process : 844][org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler : process : 581][org.apache.tomcat.util.net.JIoEndpoint$Worker : run : 447][java.lang.Thread : run : 735]Thread http80814 and http80811 will access countAllocated in parallel.Since increment and decrement is NOT atomic, we think it is a potential race condition."}