{"bug_id": "42753", "title": "Bug 42753Race condition when using available() or reading in CometProcessor.event()", "description": "Tomcat version: 6.0.13 (no 6.0.13 available in the version field)When trying to process data in CometProcessor.event() either during the BEGINevent or during the READ event, it is impossible to guarantee that all data hasbeen read before returning (since new data may arrive between the last statementbefore the return, and the return statement itself). However, theCoyoteProcessor does this check: } else if (!error && read && request.getAvailable()) {// If this was a read and not all bytes have been read, or if no data// was read from the connector, then it is an errorerror = true;log.error(sm.getString(\"coyoteAdapter.read\")); }causing a severe error and the Comet request to break when this race conditionmanifests itself.I am using the following code according to the aio.html description to read datain my comet event handler:while (request.getInputStream().available()  0) {// read some data}//  NO MORE DATA AVAILABLEreturn;And I am experiencing the error as described in certain conditions (rapidarrival of fragmented data):SEVERE: The servlet did not read all available bytes during the processing ofthe read event"}