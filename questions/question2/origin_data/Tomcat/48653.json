{"bug_id": "48653", "title": "Bug 48653RemoteIpValve : request.secure and request.scheme are not forced to \"false\" and \"http\" if XForwardedProto=http", "description": "Created attachment 24915 [details]Tomcat 7 patch with many unit tests, updated docs and few additional jmx attributes fixesWhen XForwardedProto=\"http\", the incoming request attributes secure, schemeand serverPort are not overridden as they are with \"https\".If a request came as unsecured/http but the communication between apache andtomcat is ssl, then request.isSecure(), request.getScheme() andrequest.getServerPort() are wrong.Proposed patch : introduce a httpServerPort configuration parameter modify logic for request.isSecure(), request.getScheme() , andrequest.getServerPort() : if header \"xforwardedproto\" is null then keep incoming values else if header \"xforwardedproto\" is equal to \"https\" then override valuesto true, https and 443 else override values to false, http and 80Note : \"xforwardedproto\", 80, 443 and \"https\" (as the ssl value forxforwardedproto header) are configurable ; I use sample values in the bugdescription to make it easier to understand."}