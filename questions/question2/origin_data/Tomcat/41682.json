{"bug_id": "41682", "title": "Bug 41682ClassCastException with BackupManager + debug logging", "description": "(Still happening in 6.0.9, though that isn't an option in Bugzilla)If I use the BackupManager for session replication AND turn on debug logging, Iget this exception when I try to invalidate the session:java.lang.ClassCastException: org.apache.catalina.ha.session.BackupManagercannot be cast to org.apache.catalina.ha.session.DeltaManagerat org.apache.catalina.ha.session.DeltaSession.expire(DeltaSession.java:361)at org.apache.catalina.ha.session.DeltaSession.expire(DeltaSession.java:352)at org.apache.catalina.session.StandardSession.expire(StandardSession.java:660)atorg.apache.catalina.session.StandardSession.invalidate(StandardSession.java:1112)atorg.apache.catalina.session.StandardSessionFacade.invalidate(StandardSessionFacade.java:150)The bug is easy to find in the source.If debug logging is enabled, it tries tocast manager to DeltaManager without an instanceof, even though it is doing aninstanceof immediately after:public void expire(boolean notify, boolean notifyCluster) {String expiredId = getIdInternal();super.expire(notify);if (notifyCluster) {if (log.isDebugEnabled())log.debug(sm.getString(\"deltaSession.notifying\",((DeltaManager)manager).getName(),new Boolean(isPrimarySession()),expiredId));if ( manager instanceof DeltaManager ) {( (DeltaManager) manager).sessionExpired(expiredId);}}}"}