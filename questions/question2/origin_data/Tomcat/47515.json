{"bug_id": "47515", "title": "Bug 47515Tomcat can't replicate session when it is started.", "description": "Systemtwo Tomcat Server(AP1,AP2)Tomcat's version is 6.0.18.Replication method is Delta ManagerI stopped Tomcat of AP1. Then, I restarted Tomcat of AP1. Then, for AP1, Tomcat's log is as follows.Jul 2, 2009 4:51:04 PMorg.apache.catalina.ha.session.DeltaManager getAllClusterSessionsWARNING: Manager [/tpcw]: Drop message SESSIONDELTAinside GETALLSESSIONS sync phase start date 7/2/09 4:51 PM message date 1/1/70 9:00 AMJul 2, 2009 4:51:04 PMorg.apache.catalina.ha.session.DeltaManager getAllClusterSessionsWARNING: Manager [/tpcw]: Drop message SESSIONACCESSEDinside GETALLSESSIONS sync phase start date 7/2/09 4:51 PM message date 1/1/70 9:00 AMTimeStamp is incorrect when SESSIONDELTA or SESSIONACCESSED because \"1/1/70 9:00 AM\" isn't created time of session. In this case, AP1's Tomcat may drop all session data. As a result, AP1's Tomcat can't replicate session. If TimeStamp is updated when update last replicated time, it goes well.I made patch.DeltaManager's patch.Index: java/org/apache/catalina/ha/session/DeltaManager.java=================================================================== java/org/apache/catalina/ha/session/DeltaManager.java(revision 792004)+++ java/org/apache/catalina/ha/session/DeltaManager.java(working copy)@@ 1162,7 +1162,10 @@}//update last replicated timeif (msg != null) session.setLastTimeReplicated(System.currentTimeMillis());+if (msg != null){+session.setLastTimeReplicated(System.currentTimeMillis());+msg.setTimestamp(session.getLastTimeReplicated());+}return msg;} catch (IOException x) {log.error(sm.getString(\"deltaManager.createMessage.unableCreateDeltaRequest\",sessionId), x);"}