{"bug_id": "47462", "title": "Bug 47462The annotation doesn't become effective.(metadatacomplete=\"false\" is not effective.)", "description": "Even if \"false\" is set to metadatacomplete,the annotation doesn't become effective.To invalidate the annotation by all the Web applications of Tomcat,metadatacomplete of conf/web.xml is set to \"true\".[conf/web.xml]<webapp xmlns=\"http://java.sun.com/xml/ns/javaee\"xmlns:xsi=\"http://www.w3.org/2001/XMLSchemainstance\"xsi:schemaLocation=\"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/webapp25.xsd\"version=\"2.5\"metadatacomplete=\"true\".....</webappTo make the annotation of Web application (testWebApp) effective,metadatacomplete of webapps/testWebApp/WEBINF/web.xml is set to \"false\".[webapps/testWebApp/WEBINF/web.xml]<webapp xmlns=\"http://java.sun.com/xml/ns/javaee\"xmlns:xsi=\"http://www.w3.org/2001/XMLSchemainstance\"xsi:schemaLocation=\"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/webapp25.xsd\"version=\"2.5\"metadatacomplete=\"false\"....</webappHowever, testWebApp doesn't make the annotation effective.Because WebRuleSetIgnoreAnnotationsRulebegin is as follows.When metadatacomplete is \"false\", context.setIgnoreAnnotations(false) is not invoked.[WebRuleSetIgnoreAnnotationsRulebegin]final class IgnoreAnnotationsRule extends Rule {public IgnoreAnnotationsRule() {}public void begin(String namespace, String name, Attributes attributes)throws Exception {Context context = (Context) digester.peek(digester.getCount()  1);String value = attributes.getValue(\"metadatacomplete\");if (\"true\".equals(value)) {context.setIgnoreAnnotations(true);}if (digester.getLogger().isDebugEnabled()) {digester.getLogger().debug(context.getClass().getName() + \".setIgnoreAnnotations( \" +context.getIgnoreAnnotations() + \")\");}}}I think that the following patches are necessary.Index: java/org/apache/catalina/startup/WebRuleSet.java=================================================================== java/org/apache/catalina/startup/WebRuleSet.java(revision 763870)+++ java/org/apache/catalina/startup/WebRuleSet.java(working copy)@@ 848,6 +848,8 @@String value = attributes.getValue(\"metadatacomplete\");if (\"true\".equals(value)) {context.setIgnoreAnnotations(true);+} else if (\"false\".equals(value)) {+context.setIgnoreAnnotations(false);}if (digester.getLogger().isDebugEnabled()) {digester.getLogger().debugBest regards."}