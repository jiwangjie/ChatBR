{
  "id": "50016",
  "title": "Bug 50016 - Bad division of responsibility around isUserInRole and new Request login and logout methods",
  "description": "There is an issue regarding the division of responsibility in the software related to the isUserInRole method and the new Request login and logout methods. The problem is described in detail below, and I have also attached additional information to clarify the situation.",
  "OB": "The current implementation of Request.isUserInRole exhibits two problems. First, it attempts to prevent JACC (Java Authorization Contract for Containers) implementations, and second, it behaves incorrectly when dealing with role mappings. Specifically, when a user is not in the mapped role, the original role is tested. However, this behavior is not aligned with JACC requirements. To address this, Request.isUserInRole should provide the original role and, if possible, the servlet name to the wrapper. Additionally, when there is a mapping, only the mapped role should be checked. Currently, the implementation reports 'true' for both the original and mapped roles. This should not be the case.",
  "EB": "To resolve these issues, Request.isUserInRole should be reasonably amenable to a JACC implementation by supplying the original role and servlet name to the wrapper when possible. If there is a role mapping, only the mapped role should be checked. This means that a user who logs in and is in role A but not in role B should be able to test 'is in A' as 'false' and 'is in B' as 'true'. Additionally, both Request.isUserInRole and the new login and logout methods should be delegated directly to the Authenticator. The Authenticator should have the flexibility to decide whether it wants to cache the authentication results.",
  "SR": "1. Log in as a user with multiple roles, including a role that has a mapping to another role.\n2. Use the Request.isUserInRole method to check if the user is in the original and mapped roles.\n3. Observe the incorrect behavior where both the original and mapped roles are reported as 'true' when it should be 'false' for the original role and 'true' for the mapped role.\n4. Implement the necessary changes to delegate both Request.isUserInRole and the new login and logout methods to the Authenticator, allowing it to decide whether to cache authentication results."
}