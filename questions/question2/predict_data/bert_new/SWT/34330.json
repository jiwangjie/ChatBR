{"id": "34330", "title": "Bug 34330Problem with TreeEditor when expanding tree item", "description": "Bug 34330Problem with TreeEditor when expanding tree item ;import org.eclipse.swt.graphics. ;import org.eclipse.swt.widgets. ;import org.eclipse.swt.layout. ;import org.eclipse.swt.custom. ;public class A {public static void main (String [] args) {final Display display = new Display ();final Color black = display.getSystemColor (SWT.COLORBLACK);Shell shell = new Shell (display);shell.setLayout (new FillLayout ());final Tree tree = new Tree (shell, SWT.BORDER);/for (int i=0; i<16; i++) {TreeItem item = new TreeItem (tree, SWT.NONE);item.setText (\"Item \" + i);}// [A] set children so we can expand /for (int i = 0; i < 12; i++) {TreeItem treeItem = new TreeItem(tree, SWT.NULL);treeItem.setText(\"Item \" + i);TreeItem childItem = new TreeItem(treeItem, SWT.NONE);childItem.setText(\"child item\" + i);}final TreeItem [] lastItem = new TreeItem [1];final TreeEditor editor = new TreeEditor (tree);tree.addListener (SWT.Selection, new Listener () {public void handleEvent (Event e) {final TreeItem item = (TreeItem) e.item;if (item != null && item == lastItem [0]) {final Composite composite = newComposite (tree, SWT.NONE);composite.setBackground (black);final Text text = new Text(composite, SWT.NONE);composite.addListener (SWT.Resize,new Listener () {public void handleEvent(Event e) {Rectangle rect= composite.getClientArea ();text.setBounds(rect.x + 1, rect.y + 1, rect.width2, rect.height2);}});Listener textListener = new Listener() {public void handleEvent(final Event e) {switch (e.type){caseSWT.DefaultSelection:item.setText (text.getText ());//FALL THROUGHcaseSWT.FocusOut:composite.dispose ();break;caseSWT.Verify:String newText = text.getText ();String leftText = newText.substring (0, e.start);String rightText = newText.substring (e.end, newText.length ());GC gc = new GC (text);Point size = gc.textExtent (leftText + e.text + rightText);gc.dispose ();size = text.computeSize (size.x, SWT.DEFAULT);editor.horizontalAlignment = SWT.LEFT;Rectangle itemRect = item.getBounds (), rect = tree.getClientArea ();editor.minimumWidth = Math.max (size.x, itemRect.width) + 2;int left = itemRect.x, right = rect.x + rect.width;editor.minimumWidth = Math.min (editor.minimumWidth, rightleft);editor.layout ();break;caseSWT.Traverse:if (e.detail == SWT.TRAVERSEESCAPE) {composite.dispose ();e.doit = false;}break;}}};text.addListener(SWT.DefaultSelection, textListener);text.addListener (SWT.FocusOut,textListener);text.addListener (SWT.Traverse,textListener);text.addListener (SWT.Verify,textListener);editor.setEditor (composite, item);text.setText (item.getText ());text.selectAll ();text.setFocus ();}lastItem [0] = item;}});shell.pack ();shell.open ();while (!shell.isDisposed()) {if (!display.readAndDispatch ()) display.sleep ();}display.dispose ();}} ", "OB": "This is the code snippet 111 as is with one exception: the tree contains chlidren(see [A])It throws the following stacktrace:org.eclipse.swt.SWTException: Widget is disposedat org.eclipse.swt.SWT.error(SWT.java:2316)at org.eclipse.swt.SWT.error(SWT.java:2246)at org.eclipse.swt.widgets.Widget.error(Widget.java:381)at org.eclipse.swt.widgets.Control.getDisplay(Control.java:731)at org.eclipse.swt.widgets.Widget.isValidThread(Widget.java:589)at org.eclipse.swt.widgets.Widget.checkWidget(Widget.java:311)at org.eclipse.swt.widgets.Control.setVisible(Control.java:2231)at org.eclipse.swt.custom.TreeEditor$1.treeExpanded(TreeEditor.java:84)at org.eclipse.swt.widgets.TypedListener.handleEvent(TypedListener.java:173)at org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:77)at org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:836)at org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:861)at org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:845)at org.eclipse.swt.widgets.Tree.wmNotifyChild(Tree.java:1890)at org.eclipse.swt.widgets.Control.WMNOTIFY(Control.java:3811)at org.eclipse.swt.widgets.Composite.WMNOTIFY(Composite.java:638)at org.eclipse.swt.widgets.Control.windowProc(Control.java:2811)at org.eclipse.swt.widgets.Decorations.windowProc(Decorations.java:1225)at org.eclipse.swt.widgets.Display.windowProc(Display.java:2283)at org.eclipse.swt.internal.win32.OS.CallWindowProcW(Native Method)at org.eclipse.swt.internal.win32.OS.CallWindowProc(OS.java:1232)at org.eclipse.swt.widgets.Tree.callWindowProc(Tree.java:152)at org.eclipse.swt.widgets.Tree.WMLBUTTONDOWN(Tree.java:1498)at org.eclipse.swt.widgets.Control.windowProc(Control.java:2794)at org.eclipse.swt.widgets.Display.windowProc(Display.java:2283)at org.eclipse.swt.internal.win32.OS.DispatchMessageW(Native Method)at org.eclipse.swt.internal.win32.OS.DispatchMessage(OS.java:1299)at org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:1483)at A.main(A.java:97)Exception in thread \"main\"/Copyright (c) 2000, 2003 IBM Corp.All rights reserved.This file is made available under the terms of the Common Public License v1.0which accompanies this distribution, and is available athttp://www.eclipse.org/legal/cplv10.html /import org.eclipse.swt. ", "EB": "", "SR": ""}