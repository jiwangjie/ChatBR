{"id": "40817", "title": "Bug 40817servletcgi throws index out of bounds exception on certain cgi", "description": "First, servletscgi.jar needs to exist and the servlet must be mapped:for example: <servletmapping<servletnamecgi</servletname<urlpattern.pl</urlpattern </servletmappingTest perl cgi script: !/usr/bin/perl print \"Contenttype: text/plain\", \"\\n\\n\"; print \"Hello world, from Perl\\n\";One perl script is placed in wwwroot (\"/test.pl\") and the other in anysubfolder (\"/test/test.pl\" or \"/cgibin/test.pl\", etc. )(on a side note, I have one more bug to fix; the ENVVAR \"SCRIPTFILENAME\" isn'tdefined as it should be [required for PHP4/5] but I'll submit a differentbug/fix for that.) ", "OB": "Bug 40817servletcgi throws index out of bounds exception on certain cgi )The cgi script in the subfolder will run fine.The cgi script in the wwwroot will generate an exception:java.lang.StringIndexOutOfBoundsException: String index out of range: 1java.lang.String.substring(String.java:1768)java.lang.String.substring(String.java:1735)org.apache.catalina.servlets.CGIServlet$CGIEnvironment.findCGI(CGIServlet.java:948)org.apache.catalina.servlets.CGIServlet$CGIEnvironment.setCGIEnvironment(CGIServlet.java:1015)org.apache.catalina.servlets.CGIServlet$CGIEnvironment.<init(CGIServlet.java:766)org.apache.catalina.servlets.CGIServlet.doGet(CGIServlet.java:584)javax.servlet.http.HttpServlet.service(HttpServlet.java:689)javax.servlet.http.HttpServlet.service(HttpServlet.java:802)The problem is this line (line 948 in CGIServlet.java):cginame =currentLocation.getParent().substring(webAppRootDir.length())+ File.separator +name;The problem is that webAppRootDir is 1 char longer thancurrentLocation.getParent() because webAppRootDir ends with a File.separator (inthis case, a \"/\").And removing the extra File.separator from webAppRootDirwill result in a different String related exception elsewhere.And here's a fix that works:cginame = (currentLocation.getParent() +File.separator).substring(webAppRootDir.length()) + name;(If necessary, the fix can be made more adaptive by checking to see if it reallydoes have a File.separator at the end and if not...add it...otherwise, let itbe, etc. ", "EB": "", "SR": ""}