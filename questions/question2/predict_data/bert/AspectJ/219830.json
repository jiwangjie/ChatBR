{"id": "219830", "title": "Bug 219830java.lang.NullPointerException in Java15AnnotationFinder when using SWT", "description": " Bug 219830java.lang.NullPointerException in Java15AnnotationFinder when using SWT", "OB": " I receive the following Exception when running SWT with AspjectJ load time weaving through the Spring Framework.The lines around org.aspectj.weaver.reflect.Java15AnnotationFinder.getAnnotations(Java15AnnotationFinder.java:123) are as follows:for (int i = 0; i < anns.length; i++) {annSet.add(world.resolve(UnresolvedType.forSignature(anns[i].getTypeSignature())));}When using the debugger, I see \"world\" as a null value.Attached is a stripped down Eclipse project that generates the error during startup.My runtime arguments are as follows:javaagent:${resourceloc:/AspectJBug/lib/springagent.jar}[AppClassLoader@19d819d8] abort trouble in:final class org.eclipse.swt.awt.SWTAWT$10 extends java.lang.Object implements java.lang.Runnable:private final java.awt.Frame val$frame [Synthetic]void <init(java.awt.Frame):ALOAD0// Lorg/eclipse/swt/awt/SWTAWT$10; this(line 274)INVOKESPECIAL java.lang.Object.<init ()Vconstructorexecution(void org.eclipse.swt.awt.SWTAWT$10.<init(java.awt.Frame))|ALOAD0// Lorg/eclipse/swt/awt/SWTAWT$10; this(line 1)|ALOAD1|PUTFIELD org.eclipse.swt.awt.SWTAWT$10.val$frame Ljava/awt/Frame;|RETURNconstructorexecution(void org.eclipse.swt.awt.SWTAWT$10.<init(java.awt.Frame))end void <init(java.awt.Frame)public void run():methodexecution(void org.eclipse.swt.awt.SWTAWT$10.run())| catch java.lang.ThrowableE0| |LDC \"sun.awt.windows.WComponentPeer\"(line 277)| | methodcall(java.lang.Class java.lang.Class.forName(java.lang.String))| | |INVOKESTATIC java.lang.Class.forName (Ljava/lang/String;)Ljava/lang/Class;| | methodcall(java.lang.Class java.lang.Class.forName(java.lang.String))| |ASTORE1| |ALOAD1// Ljava/lang/Class; clazz(line 278)| |LDC \"winGraphicsConfig\"| | methodcall(java.lang.reflect.Field java.lang.Class.getDeclaredField(java.lang.String))| | |INVOKEVIRTUAL java.lang.Class.getDeclaredField (Ljava/lang/String;)Ljava/lang/reflect/Field;| | methodcall(java.lang.reflect.Field java.lang.Class.getDeclaredField(java.lang.String))| |ASTORE2| |ALOAD2// Ljava/lang/reflect/Field; field(line 279)| |ICONST1| | methodcall(void java.lang.reflect.Field.setAccessible(boolean))| | |INVOKEVIRTUAL java.lang.reflect.Field.setAccessible (Z)V| | methodcall(void java.lang.reflect.Field.setAccessible(boolean))| |ALOAD2// Ljava/lang/reflect/Field; field(line 280)| |ALOAD0// Lorg/eclipse/swt/awt/SWTAWT$10; this| |GETFIELD org.eclipse.swt.awt.SWTAWT$10.val$frame Ljava/awt/Frame;| | methodcall(java.awt.peer.ComponentPeer java.awt.Frame.getPeer())| | |INVOKEVIRTUAL java.awt.Frame.getPeer ()Ljava/awt/peer/ComponentPeer;| | methodcall(java.awt.peer.ComponentPeer java.awt.Frame.getPeer())| |ALOAD0// Lorg/eclipse/swt/awt/SWTAWT$10; this| |GETFIELD org.eclipse.swt.awt.SWTAWT$10.val$frame Ljava/awt/Frame;| |INVOKEVIRTUAL java.awt.Frame.getGraphicsConfiguration ()Ljava/awt/GraphicsConfiguration;| |INVOKEVIRTUAL java.lang.reflect.Field.set (Ljava/lang/Object;Ljava/lang/Object;)V| catch java.lang.ThrowableE0|GOTO L0|E0: POP(line 281)|L0: RETURN(line 282)methodexecution(void org.eclipse.swt.awt.SWTAWT$10.run())end public void run()end final class org.eclipse.swt.awt.SWTAWT$10(NullPointerException) nullnulljava.lang.NullPointerExceptionat org.aspectj.weaver.reflect.Java15AnnotationFinder.getAnnotations(Java15AnnotationFinder.java:123)at org.aspectj.weaver.reflect.ReflectionBasedResolvedMemberImpl.unpackAnnotations(ReflectionBasedResolvedMemberImpl.java:174)at org.aspectj.weaver.reflect.ReflectionBasedResolvedMemberImpl.hasAnnotation(ReflectionBasedResolvedMemberImpl.java:158)at org.aspectj.weaver.patterns.ExactAnnotationTypePattern.matches(ExactAnnotationTypePattern.java:82)at org.aspectj.weaver.patterns.AnnotationPointcut.matchInternal(AnnotationPointcut.java:151)at org.aspectj.weaver.patterns.Pointcut.match(Pointcut.java:146)at org.aspectj.weaver.patterns.AndPointcut.matchInternal(AndPointcut.java:52)at org.aspectj.weaver.patterns.Pointcut.match(Pointcut.java:146)at org.aspectj.weaver.ShadowMunger.match(ShadowMunger.java:75)at org.aspectj.weaver.Advice.match(Advice.java:112)at org.aspectj.weaver.bcel.BcelAdvice.match(BcelAdvice.java:118)at org.aspectj.weaver.bcel.BcelClassWeaver.match(BcelClassWeaver.java:2811)at org.aspectj.weaver.bcel.BcelClassWeaver.matchInvokeInstruction(BcelClassWeaver.java:2773)at org.aspectj.weaver.bcel.BcelClassWeaver.match(BcelClassWeaver.java:2506)at org.aspectj.weaver.bcel.BcelClassWeaver.match(BcelClassWeaver.java:2332)at org.aspectj.weaver.bcel.BcelClassWeaver.weave(BcelClassWeaver.java:494)at org.aspectj.weaver.bcel.BcelClassWeaver.weave(BcelClassWeaver.java:119)at org.aspectj.weaver.bcel.BcelWeaver.weave(BcelWeaver.java:1651)at org.aspectj.weaver.bcel.BcelWeaver.weaveWithoutDump(BcelWeaver.java:1602)at org.aspectj.weaver.bcel.BcelWeaver.weaveAndNotify(BcelWeaver.java:1380)at org.aspectj.weaver.bcel.BcelWeaver.weave(BcelWeaver.java:1200)at org.aspectj.weaver.tools.WeavingAdaptor.getWovenBytes(WeavingAdaptor.java:360)at org.aspectj.weaver.tools.WeavingAdaptor.weaveClass(WeavingAdaptor.java:262)at org.aspectj.weaver.loadtime.Aj.preProcess(Aj.java:78)at org.aspectj.weaver.loadtime.ClassPreProcessorAgentAdapter.transform(ClassPreProcessorAgentAdapter.java:52)at org.springframework.context.weaving.AspectJWeavingEnabler$AspectJClassBypassingClassFileTransformerDecorator.transform(AspectJWeavingEnabler.java:84)at sun.instrument.TransformerManager.transform(TransformerManager.java:141)at sun.instrument.InstrumentationImpl.transform(InstrumentationImpl.java:174)at java.lang.ClassLoader.defineClassImpl(Native Method)at java.lang.ClassLoader.defineClass(ClassLoader.java:228)at java.security.SecureClassLoader.defineClass(SecureClassLoader.java:148)at java.net.URLClassLoader.defineClass(URLClassLoader.java:557)at java.net.URLClassLoader.access$400(URLClassLoader.java:120)at java.net.URLClassLoader$ClassFinder.run(URLClassLoader.java:962)at java.security.AccessController.doPrivileged(AccessController.java:275)at java.net.URLClassLoader.findClass(URLClassLoader.java:488)at java.lang.ClassLoader.loadClass(ClassLoader.java:607)at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:327)at java.lang.ClassLoader.loadClass(ClassLoader.java:573)at org.eclipse.swt.awt.SWTAWT.newFrame(SWTAWT.java:274)Feb 21, 2008 12:09:23 PM org.aspectj.weaver.tools.Jdk14Trace errorSEVERE: org/eclipse/swt/awt/SWTAWT$10java.lang.NullPointerExceptionat org.aspectj.weaver.reflect.Java15AnnotationFinder.getAnnotations(Java15AnnotationFinder.java:123)at org.aspectj.weaver.reflect.ReflectionBasedResolvedMemberImpl.unpackAnnotations(ReflectionBasedResolvedMemberImpl.java:174)at org.aspectj.weaver.reflect.ReflectionBasedResolvedMemberImpl.hasAnnotation(ReflectionBasedResolvedMemberImpl.java:158)at org.aspectj.weaver.patterns.ExactAnnotationTypePattern.matches(ExactAnnotationTypePattern.java:82)at org.aspectj.weaver.patterns.AnnotationPointcut.matchInternal(AnnotationPointcut.java:151)at org.aspectj.weaver.patterns.Pointcut.match(Pointcut.java:146)at org.aspectj.weaver.patterns.AndPointcut.matchInternal(AndPointcut.java:52)at org.aspectj.weaver.patterns.Pointcut.match(Pointcut.java:146)at org.aspectj.weaver.ShadowMunger.match(ShadowMunger.java:75)at org.aspectj.weaver.Advice.match(Advice.java:112)at org.aspectj.weaver.bcel.BcelAdvice.match(BcelAdvice.java:118)at org.aspectj.weaver.bcel.BcelClassWeaver.match(BcelClassWeaver.java:2811)at org.aspectj.weaver.bcel.BcelClassWeaver.matchInvokeInstruction(BcelClassWeaver.java:2773)at org.aspectj.weaver.bcel.BcelClassWeaver.match(BcelClassWeaver.java:2506)at org.aspectj.weaver.bcel.BcelClassWeaver.match(BcelClassWeaver.java:2332)at org.aspectj.weaver.bcel.BcelClassWeaver.weave(BcelClassWeaver.java:494)at org.aspectj.weaver.bcel.BcelClassWeaver.weave(BcelClassWeaver.java:119)at org.aspectj.weaver.bcel.BcelWeaver.weave(BcelWeaver.java:1651)at org.aspectj.weaver.bcel.BcelWeaver.weaveWithoutDump(BcelWeaver.java:1602)at org.aspectj.weaver.bcel.BcelWeaver.weaveAndNotify(BcelWeaver.java:1380)at org.aspectj.weaver.bcel.BcelWeaver.weave(BcelWeaver.java:1200)at org.aspectj.weaver.tools.WeavingAdaptor.getWovenBytes(WeavingAdaptor.java:360)at org.aspectj.weaver.tools.WeavingAdaptor.weaveClass(WeavingAdaptor.java:262)at org.aspectj.weaver.loadtime.Aj.preProcess(Aj.java:78)at org.aspectj.weaver.loadtime.ClassPreProcessorAgentAdapter.transform(ClassPreProcessorAgentAdapter.java:52)at org.springframework.context.weaving.AspectJWeavingEnabler$AspectJClassBypassingClassFileTransformerDecorator.transform(AspectJWeavingEnabler.java:84)at sun.instrument.TransformerManager.transform(TransformerManager.java:141)at sun.instrument.InstrumentationImpl.transform(InstrumentationImpl.java:174)at java.lang.ClassLoader.defineClassImpl(Native Method)at java.lang.ClassLoader.defineClass(ClassLoader.java:228)at java.security.SecureClassLoader.defineClass(SecureClassLoader.java:148)at java.net.URLClassLoader.defineClass(URLClassLoader.java:557)at java.net.URLClassLoader.access$400(URLClassLoader.java:120)at java.net.URLClassLoader$ClassFinder.run(URLClassLoader.java:962)at java.security.AccessController.doPrivileged(AccessController.java:275)at java.net.URLClassLoader.findClass(URLClassLoader.java:488)at java.lang.ClassLoader.loadClass(ClassLoader.java:607)at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:327)at java.lang.ClassLoader.loadClass(ClassLoader.java:573)at org.eclipse.swt.awt.SWTAWT.newFrame(SWTAWT.java:274)", "EB": "", "SR": ""}