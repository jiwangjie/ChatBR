{"id": "34820", "title": "Bug 34820ajc aspectpathfails with NPE for cflow pointcuts", "description": " Bug 34820ajc aspectpathfails with NPE for cflow pointcuts ajc A.ajoutjar tmp.jarC:\\aspectj1.1\\doc\\examples\\bug\\A.aj:5 no match for this type name: Test[Xlint:invalidAbsoluteTypeName]1 warning ajc Test.java aspectpath tmp.jarjava.lang.NullPointerExceptionatorg.aspectj.ajdt.internal.compiler.lookup.EclipseFactory.makeEclipseTypeMunger(EclipseFactory.java:163)atorg.aspectj.ajdt.internal.compiler.lookup.EclipseFactory.finishTypeMungers(EclipseFactory.java:147)atorg.aspectj.ajdt.internal.compiler.lookup.AjLookupEnvironment.completeTypeBindings(AjLookupEnvironment.java:91)at org.eclipse.jdt.internal.compiler.Compiler.beginToCompile(Compiler.java:312)at org.eclipse.jdt.internal.compiler.Compiler.compile(Compiler.java:326)at org.eclipse.jdt.internal.core.builder.AbstractImageBuilder.compile(AbstractImageBuilder.java:232)at org.eclipse.jdt.internal.core.builder.AbstractImageBuilder.compile(AbstractImageBuilder.java:171)atorg.aspectj.ajdt.internal.core.builder.AjBuildManager$BatchBuilder.run(AjBuildManager.java:655)at org.aspectj.ajdt.internal.core.builder.AjBuildManager.batchBuild(AjBuildManager.java:139)at org.aspectj.ajdt.ajc.AjdtCommand.runCommand(AjdtCommand.java:55)at org.aspectj.tools.ajc.Main.run(Main.java:216)at org.aspectj.tools.ajc.Main.runMain(Main.java:155)at org.aspectj.tools.ajc.Main.main(Main.java:72)C:\\aspectj1.1\\doc\\examples\\bug\\Test.java:0 Internal compiler errorjava.lang.NullPointerExceptionatorg.aspectj.ajdt.internal.compiler.lookup.EclipseFactory.makeEclipseTypeMunger(EclipseFactory.java:163)atorg.aspectj.ajdt.internal.compiler.lookup.EclipseFactory.finishTypeMungers(EclipseFactory.java:147)atorg.aspectj.ajdt.internal.compiler.lookup.AjLookupEnvironment.completeTypeBindings(AjLookupEnvironment.java:91)at org.eclipse.jdt.internal.compiler.Compiler.beginToCompile(Compiler.java:312)at org.eclipse.jdt.internal.compiler.Compiler.compile(Compiler.java:326)at org.eclipse.jdt.internal.core.builder.AbstractImageBuilder.compile(AbstractImageBuilder.java:232)at org.eclipse.jdt.internal.core.builder.AbstractImageBuilder.compile(AbstractImageBuilder.java:171)atorg.aspectj.ajdt.internal.core.builder.AjBuildManager$BatchBuilder.run(AjBuildManager.java:655)at org.aspectj.ajdt.internal.core.builder.AjBuildManager.batchBuild(AjBuildManager.java:139)at org.aspectj.ajdt.ajc.AjdtCommand.runCommand(AjdtCommand.java:55)at org.aspectj.tools.ajc.Main.run(Main.java:216)at org.aspectj.tools.ajc.Main.runMain(Main.java:155)at org.aspectj.tools.ajc.Main.main(Main.java:72)!! no source information available ! !Exception thrown from AspectJ DEVELOPMENTThis might be logged as a bug alreadyfind current bugs athttp://bugs.eclipse.org/bugs/buglist.cgi?product=AspectJ&component=CompilerBugs for exceptions thrown have titles File:line from the top stack,e.g., \"SomeFile.java:243\"If you don't find the exception below in a bug, please add a new bugat http://bugs.eclipse.org/bugs/enterbug.cgi?product=AspectJTo make the bug a priority, please include a test programthat can reproduce this exception.nulljava.lang.NullPointerExceptionatorg.aspectj.ajdt.internal.compiler.lookup.EclipseFactory.makeEclipseTypeMunger(EclipseFactory.java:163)atorg.aspectj.ajdt.internal.compiler.lookup.EclipseFactory.finishTypeMungers(EclipseFactory.java:147)atorg.aspectj.ajdt.internal.compiler.lookup.AjLookupEnvironment.completeTypeBindings(AjLookupEnvironment.java:91)at org.eclipse.jdt.internal.compiler.Compiler.beginToCompile(Compiler.java:312)at org.eclipse.jdt.internal.compiler.Compiler.compile(Compiler.java:326)at org.eclipse.jdt.internal.core.builder.AbstractImageBuilder.compile(AbstractImageBuilder.java:232)at org.eclipse.jdt.internal.core.builder.AbstractImageBuilder.compile(AbstractImageBuilder.java:171)atorg.aspectj.ajdt.internal.core.builder.AjBuildManager$BatchBuilder.run(AjBuildManager.java:655)at org.aspectj.ajdt.internal.core.builder.AjBuildManager.batchBuild(AjBuildManager.java:139)at org.aspectj.ajdt.ajc.AjdtCommand.runCommand(AjdtCommand.java:55)at org.aspectj.tools.ajc.Main.run(Main.java:216)at org.aspectj.tools.ajc.Main.runMain(Main.java:155)at org.aspectj.tools.ajc.Main.main(Main.java:72)1 fail|abort, 1 errorSignal 127Possible fix:The NullPointerException happens because concret.getMunger() returns nulljust before calling EclipseTypeMunger.supportsKind.The following guard in the EclipseFactory.makeEclipseTypeMunger fixesthe problem:public EclipseTypeMunger makeEclipseTypeMunger(ConcreteTypeMunger concrete) {if (concrete instanceof EclipseTypeMunger) return(EclipseTypeMunger)concrete;if ( concrete.getMunger() == null){System.err.println(\"TODO (per.hustad):\" + this.getClass().getName() +\" concrete.getMunger() returned null for \" + concrete + \"willreturn null now! \");return null;}if (EclipseTypeMunger.supportsKind(concrete.getMunger().getKind())) {return new EclipseTypeMunger(this, concrete.getMunger(), concrete.getAspectType(), null);} else {return null;}}", "OB": " ajc version: AspectJ Compiler DEVELOPMENT CVS build 20030311 20:00 GMT+1(This is probably a regression bug since it does not appear in ajc 1.1b4)When using the ajc aspectpath option, the compiler crashes with a NPE.", "EB": "", "SR": " ajc version: AspectJ Compiler DEVELOPMENT CVS build 20030311 20:00 GMT+1(This is probably a regression bug since it does not appear in ajc 1.1b4)When using the ajc aspectpath option, the compiler crashes with a NPE. Thisdoes not occur when compiling without the aspectpath option.To reproduce:Extract the two files to en empty directory://File: A.ajaspect A{pointcut withinTest(): within(Test);pointcut callToHandleOrder() :(cflow(withinTest()) && call( .handleOrder(..)));Object around(): callToHandleOrder() {return \"test\";}// End of A.aj// File: Test.javapublic class Test{public static void main(String[] args){System.out.println(new Test().handleOrder(\"test\")) ;}private String handleOrder(String t){return t;}}// End of Test.java2. Verify that the \"standard\" compile option works: ajc sourceroots .No errors are generated3.a Now try the aspectpath options. I.e first put the A.aj in an aspect \"readonly\" jar and then weave in the jar."}