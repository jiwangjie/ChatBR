{"id": "50173", "title": "Bug 50173JDBCSampler discards ResultSet from a PreparedStatement.", "description": " Hi, I am using JMeter with a Test Plan that uses a JDBC Request with a PreparedStatement query type. I have retrieved the code for the v24 tag to identify the root cause for the NPE and create a patch. This bug report includes a patch against trunk as the issue is also in trunk.The root cause is due to:org.apache.jmeter.protocol.jdbc.sampler.JDBCSampler.sample(Entry e)The code path for PreparedStatements types starting on line 204 has in it a call toorg.hsqldb.jdbc.JDBCPreparedStatement.executeUpdate()which returns a ResultSet. The two lines207,208 replaced withboolean hasResultSet = pstmt.execute();String sb = resultSetsToString(pstmt,hasResultSet,null);fixes the defect.Regards,Jeremy WhitingRed Hat", "OB": " Bug 50173JDBCSampler discards ResultSet from a PreparedStatement. When running this I am getting the following error in the jmeter.log file2010/10/28 11:30:31 INFO jmeter.threads.JMeterThread: Thread started: JDBC Users 112010/10/28 12:13:38 ERRORjmeter.threads.JMeterThread: Error while processing sampler 'PREPARED SELECT Customer JDBC Request' : java.lang.NullPointerExceptionat org.apache.jmeter.protocol.jdbc.sampler.JDBCSampler.getStringFromResultSet(JDBCSampler.java:415)at org.apache.jmeter.protocol.jdbc.sampler.JDBCSampler.resultSetsToString(JDBCSampler.java:268)at org.apache.jmeter.protocol.jdbc.sampler.JDBCSampler.sample(JDBCSampler.java:208)at org.apache.jmeter.threads.JMeterThread.processsampler(JMeterThread.java:348)at org.apache.jmeter.threads.JMeterThread.run(JMeterThread.java:243)at java.lang.Thread.run(Thread.java:619) The query (below) can be expected to return a number of recordsSELECTFROM Customer WHERE ID=? ;the param is set to 1 If I use instead a SelectStatement results are returned so the query itself is not at fault. The side effect of the call is to set the JDBCPreparedStatement.currentResultSet field member to null. JDBCSampler does not keep the ResultSet reference. Instead it is discarded. The call on the next line (208)String sb = resultSetsToString(pstmt,true,null) again tries to get the ResultSet on line 267. This causes a NullPointerException because the JDBCPreparedStatement.currentResultSet field was set to null earlier. Looking at the code path for a CALLABLE statement type (line 190) shows better handling for queries that return ResultSet.", "EB": "", "SR": ""}