{"id": "50453", "title": "Bug 50453Multiple XForwardedFor headers not handled by RemoteIP valve", "description": " Bug 50453Multiple XForwardedFor headers not handled by RemoteIP valve \"thus:(a)XForwardedFor: 192.168.0.3XForwardedFor: 222.234.0.4Is semantically equivalent to:(b)XForwardedFor: 192.168.0.3, 222.234.0.4However (a) is not handled by the RemoteIP valve as it only ever looks at the first header.For reference, this was raised on the HAproxy mailing list:http://www.formilux.org/archives/haproxy/1012/4122.htmland tomcat user's mailing list:http://mailarchives.apache.org/modmbox/tomcatusers/201012.mbox/%3C4D022C57.1070005@apache.org%3ETomcat users suggested raising a bug. Hence this.", "OB": "", "EB": " When a request comes in with multiple XForwardedFor headers the RemoteIP valve should be examining all of them in reverse order.As defined by the standard:\"Multiple messageheader fields with the same fieldname MAY be present in a message if and only if the entire fieldvalue for that header field is defined as a commaseparated list [i.e., (values)]. It MUST be possible to combine the multiple header fields into one \"fieldname: fieldvalue\" pair, without changing the semantics of the message, by appending each subsequent fieldvalue to the first, each separated by a comma. The order in which header fields with the same fieldname are received is therefore significant to the interpretation of the combined field value, and thus a proxy MUST NOT change the order of these field values when a message is forwarded.", "SR": ""}