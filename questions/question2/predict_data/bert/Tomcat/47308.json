{"id": "47308", "title": "Bug 47308Cannot join in the cluster membership.", "description": " Bug 47308Cannot join in the cluster membership. I use Tomcat6.0.20.The fix of Revision 757582(http://svn.apache.org/viewvc?view=rev&revision=757582)is applied to Tomcat6.0.20.This fix means that Tomcat6.0.20 always disabled LoopbackMode.Therefore, it is not possible to join in the membershipwhen the cluster is composed of two or more Tomcat on the same machine.I think that options for loopbackMode is better.I made patch.McastService's patch.Index: java/org/apache/catalina/tribes/membership/McastService.java=================================================================== java/org/apache/catalina/tribes/membership/McastService.java(revision 763870)+++ java/org/apache/catalina/tribes/membership/McastService.java(working copy)@@ 230,6 +230,9 @@properties.setProperty(\"recoverySleepTime\", String.valueOf(recoverySleepTime));}+public void setLocalLoopbackDisabled(boolean localLoopbackDisabled) {+properties.setProperty(\"localLoopbackDisabled\", String.valueOf(localLoopbackDisabled));+}/ @deprecated use getPort()@@ 360,7 +363,8 @@java.net.InetAddress.getByName(properties.getProperty(\"mcastAddress\")),ttl,soTimeout,this);+this,+Boolean.valueOf(properties.getProperty(\"localLoopbackDisabled\",\"true\")).booleanValue());String value = properties.getProperty(\"recoveryEnabled\",\"true\");boolean recEnabled = Boolean.valueOf(value).booleanValue() ;impl.setRecoveryEnabled(recEnabled);McastServiceImpl's patch.Index: java/org/apache/catalina/tribes/membership/McastServiceImpl.java=================================================================== java/org/apache/catalina/tribes/membership/McastServiceImpl.java(revision 763870)+++ java/org/apache/catalina/tribes/membership/McastServiceImpl.java(working copy)@@ 135,7 +135,13 @@ Add the ability to turn on/off recovery/protected boolean recoveryEnabled = true;+/+ disable/enable local loopback message+/+protected boolean localLoopbackDisabled = true;++/ Create a new mcast service impl @param memberthe local member @param sendFrequencythe time (ms) in between pings sent out@@ 144,6 +150,7 @@ @param bindthe bind address (not sure this is used yet) @param mcastAddressthe mcast address @param servicethe callback service+ @param disableLoopbackModedisable loopbackMode @throws IOException/public McastServiceImpl(@@ 155,7 +162,8 @@InetAddress mcastAddress,int ttl,int soTimeout,MembershipListener service)+MembershipListener service,+boolean localLoopbackDisabled)throws IOException {this.member = member;this.address = mcastAddress;@@ 166,6 +174,7 @@this.timeToExpiration = expireTime;this.service = service;this.sendFrequency = sendFrequency;+this.localLoopbackDisabled = localLoopbackDisabled;init();}@@ 199,7 +208,7 @@} else {socket = new MulticastSocket(port);}socket.setLoopbackMode(true); //hint that we don't need loop back messages+socket.setLoopbackMode(localLoopbackDisabled); //hint that we don't need loop back messagesif (mcastBindAddress != null) {And the localLoopbackDisabled attribute is specified for < Membershipof server.xml.example.<Membership className=\"org.apache.catalina.tribes.membership.McastService\"another attributelocalLoopbackDisabled=\"false\" /Regards.", "OB": "", "EB": "", "SR": ""}