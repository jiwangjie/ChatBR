{"id": "48737", "title": "Bug 48737JspCompilationContext assumes that tagfile with a path starting with METAINF are in jars without checking", "description": " Created attachment 24978 [details]patch to JspCompilationContextThis is a pretty special case, since tagfiles in METAINF are usually in jar files...but when using a custom dircontext implementation (usually during development in order to load files from the filesystem without building a full jar) it may happen that the path given to jasper starts with METAINF also if the file is not in a jar. This is what happens using the Eclipse WTP tomcat loader, which loads classes from the workspaces and tld/tagfiles from directories inside your projects.Tagfiles contained in METAINF directories worked properly till tomcat 6.0.17, but the final fix for BUG 43741 broke it (I am still using 6.0.16 and not upgrading due to this problem).Looking at JspCompilationContext.getResource() the patch to solve this problem would be very simple and \"safe\": if the path starts with METAINF and a jar file containing the tld doesn't exist the resulting URL is simply null.Adding a check for the null jar and setting the URL to the \"standard\" path inside the context fixes the problem and everything starts working again (note that this doesn't break the previous fix and it can't cause any problem, since the result would have been null anyway).A patch against trunk (20100213) is attached, the following code should easily displays what the patch does:URL result = null;if (res.startsWith(\"/METAINF/\")) {// some lines to get the jar url// ...if (jarUrl != null) {result = new URL(jarUrl.toExternalForm() + res.substring(1));}+else {+// the path starts with /METAINF but the file is not in a jar+result = context.getResource(canonicalURI(res));+}}", "OB": " Bug 48737JspCompilationContext assumes that tagfile with a path starting with METAINF are in jars without checking", "EB": "", "SR": ""}